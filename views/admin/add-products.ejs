<link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
  rel="stylesheet"
/>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"
/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<%- include('../partials/adminSidebar') %>

<main class="flex-1 p-3 overflow-y-auto bg-[#0d0f0d] min-h-screen text-gray-200">
  <form id="addProductForm" method="POST" action="/admin/add-products">
    <div class="max-w-[1200px] mx-auto mb-5">
      <h2 class="text-2xl font-extrabold text-white tracking-tight">Create New Product</h2>
      <a
        href="/admin/products"
        class="text-[12px] justify-end mr-8 uppercase font-bold text-gray-500 hover:text-[#4ade80] transition flex items-center mb-2 tracking-widest"
      >
        <i class="fa-solid fa-arrow-left mr-2"></i> Back to Products
      </a>
    </div>

    <div class="max-w-[1200px] mx-auto grid grid-cols-12 gap-4">
      <div class="col-span-12 lg:col-span-8 space-y-6">
        <div class="bg-[#1A1D1A] rounded-3xl border border-white/5 p-4 shadow-xl">
          <div class="flex items-center space-x-3 mb-5">
            <div
              class="w-7 h-7 rounded bg-[#4ade80]/10 flex items-center justify-center text-[#4ade80]"
            >
              <i class="fa-solid fa-circle-info text-xs"></i>
            </div>
            <h3 class="text-sm font-bold text-white uppercase tracking-wider">Basic Information</h3>
          </div>

          <div class="space-y-4">
            <div>
              <label
                class="block text-[10px] uppercase font-bold text-gray-500 mb-1.5 tracking-widest"
                >Product Name *</label
              >
              <input
                type="text"
                name="name"
                class="w-full bg-[#141a14] border border-white/10 rounded-lg px-4 py-2.5 text-sm text-white outline-none"
              />
            </div>
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label
                  class="block text-[10px] uppercase font-bold text-gray-500 mb-1.5 tracking-widest"
                  >Brand *</label
                >
                <input
                  name="brand"
                  required
                  class="w-full bg-[#141a14] border border-white/10 rounded-lg px-4 py-2.5 text-sm text-white outline-none"
                />
              </div>
              <div>
                <label
                  class="block text-[10px] uppercase font-bold text-gray-500 mb-1.5 tracking-widest"
                  >Category *</label
                >
                <select
                  name="category"
                  required
                  class="w-full bg-[#141a14] border border-white/10 rounded-lg px-4 py-2.5 text-sm text-white outline-none"
                >
                  <option value="">Select Category</option>
                  <% categories.forEach(cat=> { %>
                  <option value="<%= cat._id %>"><%= cat.name %></option>
                  <% }) %>
                </select>
              </div>
            </div>
            <div>
              <label
                class="block text-[10px] uppercase font-bold text-gray-500 mb-1.5 tracking-widest"
                >Description</label
              >
              <textarea
                name="description"
                rows="3"
                class="w-full bg-[#141a14] border border-white/10 rounded-lg px-4 py-3 text-sm text-white outline-none resize-none"
              ></textarea>
            </div>
          </div>
        </div>

        <div class="bg-[#1A1D1A] rounded-3xl border border-white/5 p-3 shadow-xl">
          <div class="flex items-center space-x-3 mb-6">
            <div
              class="w-7 h-7 rounded bg-[#4ade80]/10 flex items-center justify-center text-[#4ade80]"
            >
              <i class="fa-solid fa-palette text-xs"></i>
            </div>
            <h3 class="text-sm font-bold text-white uppercase tracking-wider">Style Variants</h3>
          </div>

          <div id="variantContainer" class="space-y-4">
            <div class="variant-card bg-black/40 rounded-xl p-5 border border-white/5 relative">
              <div class="flex justify-between items-center mb-4 border-b border-white/5 pb-3">
                <h4 class="text-[9px] uppercase font-bold text-[#4ade80] tracking-[0.2em]">
                  Variant Configuration
                </h4>
                <button
                  type="button"
                  onclick="removeVariant(this)"
                  class="text-red-500/50 hover:text-red-500 text-[9px] font-bold uppercase"
                >
                  <i class="fa-solid fa-trash-can mr-1"></i> Remove
                </button>
              </div>

              <div class="grid grid-cols-12 gap-3">
                <div class="col-span-12 md:col-span-7 grid grid-cols-2 gap-3">
                  <div class="col-span-2">
                    <label class="block text-[9px] text-gray-500 mb-1 uppercase font-bold"
                      >Color Name</label
                    >
                    <input
                      type="text"
                      name="variants[0][color]"
                      class="w-full bg-[#141a14] border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none"
                    />
                  </div>
                  <div>
                    <label class="block text-[9px] text-gray-500 mb-1 uppercase font-bold"
                      >Stock</label
                    >
                    <input
                      type="number"
                      name="variants[0][stock]"
                      class="w-full bg-[#141a14] border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none"
                    />
                  </div>
                  <div>
                    <label class="block text-[9px] text-gray-500 mb-1 uppercase font-bold"
                      >Base Price (₹)</label
                    >
                    <input
                      type="number"
                      name="variants[0][basePrice]"
                      class="base-price-input w-full bg-[#141a14] border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none"
                    />
                  </div>

                  <div class="col-span-2">
                    <label class="block text-[9px] text-gray-500 mb-1 uppercase font-bold"
                      >Final Price</label
                    >
                    <input
                      type="text"
                      readonly
                      class="final-price-display w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-xs text-[#4ade80] font-bold outline-none"
                      value="₹ 0.00"
                    />
                  </div>
                </div>

                <div class="col-span-12 md:col-span-5">
                  <label class="block text-[9px] text-gray-500 mb-2 uppercase font-bold"
                    >Media (Min 3 Images)</label
                  >
                  <div class="grid grid-cols-2 gap-2">
                    <div
                      onclick="triggerUpload(this)"
                      class="aspect-square rounded-lg bg-[#141a14] border-2 border-dashed border-white/5 flex flex-col items-center justify-center cursor-pointer hover:border-[#4ade80]/30 transition group"
                    >
                      <i
                        class="fa-solid fa-image text-gray-600 group-hover:text-[#4ade80] text-sm mb-1"
                      ></i>
                      <span class="text-[7px] text-gray-500 uppercase font-bold">Add Image</span>
                    </div>
                    <div class="imagePreviewGrid grid grid-cols-2 gap-2"></div>
                  </div>
                  <input type="file" class="imagePicker hidden" accept="image/*" />
                </div>
              </div>
            </div>
          </div>

          <button
            type="button"
            onclick="addNewVariant()"
            class="w-full mt-4 py-4 rounded-xl border border-dashed border-white/10 text-gray-500 hover:text-[#4ade80] transition flex items-center justify-center text-[10px] font-bold uppercase"
          >
            <i class="fa-solid fa-plus mr-2"></i> Add Another Style Variant
          </button>
        </div>
      </div>

      <div class="col-span-12 lg:col-span-4 space-y-6">
        <div class="bg-[#1A1D1A] rounded-3xl border border-white/5 p-6">
          <div class="flex items-center space-x-3 mb-6">
            <div
              class="w-8 h-8 rounded-lg bg-[#4ade80]/10 flex items-center justify-center text-[#4ade80]"
            >
              <i class="fa-solid fa-tag text-sm"></i>
            </div>
            <h3 class="text-lg font-bold text-white font-bold">Offer</h3>
          </div>

          <div class="space-y-4">
            <div>
              <label class="block text-[9px] text-gray-500 mb-1 uppercase font-bold"
                >Offer (%)</label
              >
              <input
                type="number"
                name="offerPercentage"
                class="offer-input w-full bg-[#141a14] border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none"
                value="0"
              />
            </div>
            <div>
              <label class="block text-[9px] text-gray-500 mb-1 uppercase font-bold"
                >Offer Expiry
              </label>
              <div class="relative">
                <input
                  type="date"
                  id="offerExpiry"
                  name="offerExpiry"
                  class="offerExpiry w-full bg-[#141a14] border border-white/10 rounded-lg px-3 py-2 text-xs text-white/60 outline-none"
                />

                <i
                  class="fa-solid fa-calendar-days absolute right-4 top-1/2 -translate-y-1/2 text-[14px] text-gray-500 pointer-events-none"
                ></i>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-[#1A1D1A] rounded-xl border border-white/5 p-6 shadow-xl">
          <h3 class="text-sm font-bold text-white uppercase mb-5">Specifications</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-[10px] text-gray-500 mb-1.5 uppercase font-bold"
                >Case Size (mm)</label
              >
              <input
                type="text"
                name="caseSize"
                class="w-full bg-[#141a14] border border-white/10 rounded-lg px-4 py-2 text-xs text-white outline-none"
              />
            </div>
            <div>
              <label class="block text-[10px] text-gray-500 mb-1.5 uppercase font-bold"
                >Strap Type</label
              >
              <input
                type="text"
                name="strapType"
                class="w-full bg-[#141a14] border border-white/10 rounded-lg px-4 py-2 text-xs text-white outline-none"
              />
            </div>
            <div>
              <label class="block text-[10px] text-gray-500 mb-1.5 uppercase font-bold"
                >Movement</label
              >
              <input
                type="text"
                name="movementType"
                class="w-full bg-[#141a14] border border-white/10 rounded-lg px-4 py-2 text-xs text-white outline-none"
              />
            </div>
          </div>
        </div>

        <div class="bg-[#1A1D1A] rounded-xl border border-white/5 p-6 shadow-xl">
          <h3 class="text-sm font-bold text-white uppercase mb-5">Product Visibility</h3>
          <div class="flex items-center justify-between">
            <div>
              <p class="text-[10px] text-white font-bold uppercase tracking-tight">List Product</p>
              <p class="text-[9px] text-gray-500 uppercase">Make visible to customers</p>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" name="isListed" class="sr-only peer" checked />
              <div
                class="w-11 h-6 bg-white/5 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-gray-500 after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#4ade80] peer-checked:after:bg-black"
              ></div>
            </label>
          </div>
        </div>
      </div>
    </div>

    <div class="max-w-[500px] mx-auto flex justify-center py-10">
      <button
        type="submit"
        class="bg-[#4ade80] text-black px-12 py-3 rounded-full text-[10px] font-extrabold uppercase hover:scale-105 transition-all"
      >
        Publish Product
      </button>
    </div>
  </form>
</main>

<script src="/admin/js/add-product.js"></script>
