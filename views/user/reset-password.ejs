<div class="flex h-full w-full items-center justify-center px-4 sm:px-6">
  <div class="w-full max-w-sm bg-card-dark mt-6 rounded-xl p-6 shadow-2xl ring-1 ring-white/10">
    <header class="mb-4 text-center">
      <h1 class="text-2xl font-bold text-white mb-2">Set New Password</h1>
      <p class="text-sm text-neutral-400">Create a strong new password for your account.</p>
    </header>

    <form
      id="newPasswordForm"
      action="/reset-password/?_method=PATCH"
      method="POST"
      class="space-y-6"
      novalidate
    >
      <!-- Flash alerts -->
      <%- include('../partials/alerts') %>

      <div>
        <label for="newPassword" class="block text-sm font-semibold text-neutral-200 mb-2"
          >NEW PASSWORD</label
        >
        <div class="relative">
          <input
            id="newPassword"
            name="newPassword"
            type="password"
            placeholder="Enter new password"
            required
            class="block w-full rounded-lg border-0 bg-dark-input py-3 px-4 text-white shadow-sm ring-1 ring-inset ring-neutral-800 placeholder:text-neutral-600 focus:ring-2 focus:ring-inset focus:ring-primary-hover focus:bg-black transition-all duration-200 sm:text-sm sm:leading-6 pr-10"
          />
          <span
            class="material-symbols-outlined absolute inset-y-0 right-0 pr-3 text-lg flex items-center text-neutral-500 cursor-pointer"
            onclick="togglePasswordVisibility('newPassword')"
          >
            visibility_off
          </span>
        </div>
        <p id="newPasswordHint" class="text-xs text-neutral-500 mt-1">
          Minimum 8 characters, must include letters and numbers.
        </p>
        <p id="newPasswordErr" class="text-xs text-red-500 mt-1 hidden"></p>
      </div>

      <div>
        <label for="confirmPassword" class="block text-sm font-semibold text-neutral-200 mb-2"
          >CONFIRM PASSWORD</label
        >
        <div class="relative">
          <input
            id="confirmPassword"
            name="confirmPassword"
            type="password"
            placeholder="Re-enter new password"
            required
            class="block w-full rounded-lg border-0 bg-dark-input py-3 px-4 text-white shadow-sm ring-1 ring-inset ring-neutral-800 placeholder:text-neutral-600 focus:ring-2 focus:ring-inset focus:ring-primary-hover focus:bg-black transition-all duration-200 sm:text-sm sm:leading-6 pr-10"
          />
          <span
            class="material-symbols-outlined absolute inset-y-0 text-lg right-0 pr-3 flex items-center text-neutral-500 cursor-pointer"
            onclick="togglePasswordVisibility('confirmPassword')"
          >
            visibility_off
          </span>
        </div>
        <p id="confirmPasswordErr" class="text-xs text-red-500 mt-1 hidden"></p>
      </div>

      <div>
        <button
          type="submit"
          class="w-full rounded-lg bg-primary py-3.5 text-black font-bold hover:bg-primary-hover transition shadow-lg shadow-primary/20"
        >
          Update Password &rarr;
        </button>
      </div>

      <p class="text-center text-sm">
        <a
          href="/login"
          class="inline-flex items-center text-neutral-400 hover:text-white transition-colors"
        >
          Back to Login
        </a>
      </p>
    </form>

    <footer class="mt-8 text-center text-xs text-neutral-600">
      <p>&copy; 2024 LUXE TIME Inc.</p>
      <p>Secure SSL Encryption</p>
    </footer>
  </div>
</div>

<script>
  // --- Password Visibility Toggle ---
  function togglePasswordVisibility(id) {
    const input = document.getElementById(id);
    const icon = input.nextElementSibling;

    if (input.type === 'password') {
      input.type = 'text';
      icon.textContent = 'visibility';
    } else {
      input.type = 'password';
      icon.textContent = 'visibility_off';
    }
  }

  // --- Client-side Validation ---
  const form = document.getElementById('newPasswordForm');
  const newPassword = document.getElementById('newPassword');
  const confirmPassword = document.getElementById('confirmPassword');
  const newPasswordErr = document.getElementById('newPasswordErr');
  const confirmPasswordErr = document.getElementById('confirmPasswordErr');

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    let valid = true;

    [newPasswordErr, confirmPasswordErr].forEach((err) => {
      err.classList.add('hidden');
      err.textContent = '';
    });

    // 1. Validate New Password strength
    if (newPassword.value.length === 0) {
      newPasswordErr.textContent = 'New password cannot be empty.';
      newPasswordErr.classList.remove('hidden');
      valid = false;
    }

    // }else if (!passwordRegex.test(newPassword.value)) {
    //     newPasswordErr.textContent = "Password must be 8+ characters, including letters and numbers.";
    //     newPasswordErr.classList.remove("hidden");
    //     valid = false;
    // }

    // 2. Validate Password match
    if (confirmPassword.value !== newPassword.value) {
      confirmPasswordErr.textContent = 'Passwords do not match.';
      confirmPasswordErr.classList.remove('hidden');
      valid = false;
    }

    if (valid) {
      // If validation passes, submit the form to the server
      // The server must handle the token validation and password update
      form.submit();
    }
  });
</script>
