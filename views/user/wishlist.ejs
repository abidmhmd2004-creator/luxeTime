<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #050605;
            color: white;
            -webkit-font-smoothing: antialiased;
        }

        .wishlist-card {
            background-color: #111211;
            /* Subtle charcoal grey for depth */
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
        }

        .btn-primary-glow {
            background-color: #22c55e;
            box-shadow: 0 0 12px rgba(34, 197, 94, 0.25);
            transition: all 0.3s ease;
        }

        .btn-primary-glow:hover {
            background-color: #26d467;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
            transform: translateY(-1px);
        }

        .product-ring {
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: #000;
            padding: 2px;
        }
    </style>
</head>

<main class="max-w-[1000px] mx-auto px-4 py-8 w-full min-h-screen">
    <nav class="flex items-center gap-2 text-[9px] font-bold uppercase tracking-[0.15em] text-zinc-600 mb-6">
        <a href="/" class="hover:text-white transition-colors">Home</a>
        <span class="opacity-20">/</span>
        <a href="/shop" class="hover:text-white transition-colors">Shop</a>
        <span class="opacity-20">/</span>
        <span class="text-zinc-400">My Wishlist</span>
    </nav>

    <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4 mb-8">
        <div>
            <h1 class="text-3xl font-extrabold uppercase tracking-tighter mb-0.5">My Wishlist</h1>
            <p class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest">
                <%= items.length %> items saved
            </p>
        </div>
        <a href="/shop"
            class="btn-primary-glow text-black px-7 py-2.5 rounded-full text-[10px] font-extrabold uppercase tracking-widest">
            Continue Shopping
        </a>
    </div>

    <% if (items && items.length> 0) { %>
        <div class="wishlist-card overflow-hidden">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr
                        class="text-[9px] uppercase font-black tracking-widest text-zinc-500 border-b border-white/5 bg-white/[0.02]">
                        <th class="px-6 py-3">Product Details</th>
                        <th class="px-6 py-3 text-center">Unit Price</th>
                        <th class="px-6 py-3 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/[0.04]">
                    <% items.forEach(item=> { %>
                        <tr class="group hover:bg-white/[0.01] transition-all">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-5">
                                    <div
                                        class="w-14 h-14 product-ring rounded-full flex-shrink-0 overflow-hidden group-hover:border-green-500/30 transition-colors">
                                        <img src="<%= item.variant.images[0].url %>" alt="<%= item.product.name %>"
                                            class="w-full h-full object-cover rounded-full opacity-90">
                                    </div>

                                    <div class="space-y-1">
                                        <h3
                                            class="text-sm font-bold text-zinc-100 tracking-tight group-hover:text-white transition-colors">
                                            <%= item.product.name %>
                                        </h3>

                                        <div class="flex gap-2">
                                            <span
                                                class="text-[8px] font-bold text-zinc-500 border border-white/10 bg-white/5 px-1.5 py-0.5 rounded-sm uppercase">
                                                <%= item.variant.color %>
                                            </span>
                                            <span
                                                class="text-[8px] font-bold text-zinc-500 border border-white/10 bg-white/5 px-1.5 py-0.5 rounded-sm uppercase">
                                                <%= item.product.specifications.movementType %>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </td>

                            <td class="px-6 py-4 text-center">
                                <div class="flex flex-col items-center">
                                    <span class="text-sm font-bold text-zinc-200">
                                        ₹<%= item.variant.finalPrice.toLocaleString('en-IN') %>
                                    </span>

                                    <% if (item.variant.basePrice> item.variant.finalPrice) { %>
                                        <div class="flex items-center gap-2 mt-0.5">
                                            <span class="text-[9px] text-zinc-500 line-through">
                                                ₹<%= item.variant.basePrice.toLocaleString('en-IN') %>
                                            </span>
                                            <span class="text-[9px] font-black text-green-500">
                                                <%= item.product.offerPercentage %>% OFF
                                            </span>
                                        </div>
                                        <% } %>
                                </div>
                            </td>

                            <td class="px-6 py-4">
                                <div class="flex justify-end items-center gap-2.5">
                                    <a href="/product/<%= item.product._id %>"
                                        class="w-8 h-8 flex items-center justify-center rounded-full bg-zinc-900/50 border border-white/5 text-zinc-500 hover:text-white hover:border-white/20 transition-all"
                                        title="View Product">
                                        <i class="far fa-eye text-[11px]"></i>
                                    </a>

                                    <button onclick="addToCart('<%= item.product._id %>','<%= item.variant._id %>')"
                                        class="w-8 h-8 flex items-center justify-center rounded-full bg-[#22c55e] text-black hover:scale-105 active:scale-95 transition-all"
                                        title="Add to Cart">
                                        <i class="fas fa-shopping-cart text-[11px]"></i>
                                    </button>

                                    <button onclick="removeFromWishlist('<%= item._id %>')"
                                        class="w-8 h-8 flex items-center justify-center rounded-full bg-zinc-900/50 border border-white/5 text-zinc-600 hover:text-red-500 transition-all"
                                        title="Remove">
                                        <i class="far fa-trash-alt text-[11px]"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <% }) %>
                </tbody>
            </table>
        </div>
        <% } else { %>
            <div class="wishlist-card py-20 text-center">
                <div
                    class="w-16 h-16 bg-zinc-900/50 rounded-full flex items-center justify-center mx-auto mb-6 border border-white/5">
                    <i class="far fa-heart text-xl text-zinc-700"></i>
                </div>
                <h2 class="text-xl font-bold uppercase tracking-tight text-white mb-2">Your wishlist is empty</h2>
                <p class="text-zinc-500 text-[11px] mb-8 max-w-xs mx-auto">Discover our exclusive collection of premium
                    timepieces.</p>
                <a href="/shop"
                    class="inline-block border border-white/10 hover:border-green-500 hover:text-green-500 text-white px-10 py-3 rounded-full text-[10px] font-bold uppercase tracking-widest transition-all">
                    Explore Collection
                </a>
            </div>
            <% } %>
</main>

<script>
    async function removeFromWishlist(itemId) {
        const res = await fetch(`/wishlist/remove/${itemId}`, {
            method: "DELETE",
        })

        const data = await res.json();

        if (data.success) {
            window.location.reload();
        }
    }

    function addToCart(productId, variantId) {
        fetch("/cart/add", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                productId,
                variantId,
            })
        })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        icon: "success",
                        title: "Added to cart",
                        text: "Item has been added to your cart",
                        showConfirmButton: false,
                        timer: 1500,
                    }).then(() => {
                        location.reload(); 
                    });

                    const cartCounte1 = document.getElementById("cartCount");

                    if (cartCounte1) {
                        cartCounte1.innerText = data.cartCount;
                        cartCounte1.style.display = "flex"
                    }

                } else {
                    Swal.fire({
                        icon: "warning",
                        title: "Oops!",
                        text: data.message || "Unable to add item"
                    })
                }
            }).catch(() => {
                Swal.fire({
                    icon: "error",
                    title: "error",
                    text: "Something went wrong.Please try again."
                })
            })
    }
</script>